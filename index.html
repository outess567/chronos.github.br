<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHRONOS - Gestão de Estudos</title>
    <!-- Fontes Modernas e Limpas -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Sora:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --font-main: 'Plus Jakarta Sans', sans-serif;
            --font-title: 'Sora', sans-serif;
        }
        body {
            font-family: var(--font-main);
            background-color: #050505;
            color: #ededed;
        }
        h1, h2, h3, .font-title, button {
            font-family: var(--font-title);
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.9);
            cursor: pointer;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #1a1a1a; border-radius: 10px; }
        
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased selection:bg-purple-500/30 min-h-screen p-6 md:p-10">

    <header class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6 mb-12">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-purple-600/20">
                <i data-lucide="clock" class="text-white w-6 h-6"></i>
            </div>
            <h1 class="text-2xl font-extrabold tracking-tight text-white">CHRONOS</h1>
        </div>
        
        <nav class="flex bg-[#0d0d0d] p-1.5 rounded-2xl border border-white/5 shadow-sm">
            <button onclick="switchTab('materias')" id="tab-materias" class="px-8 py-2.5 rounded-xl text-[10px] font-bold tracking-widest transition-all bg-[#1a1a1a] text-purple-400 border border-white/5 uppercase">
                Matérias
            </button>
            <button onclick="switchTab('organizacao')" id="tab-organizacao" class="px-8 py-2.5 rounded-xl text-[10px] font-bold tracking-widest transition-all text-gray-500 hover:text-gray-300 uppercase">
                Organização
            </button>
        </nav>
    </header>

    <main class="max-w-6xl mx-auto">
        <!-- Dashboard de Progresso -->
        <section class="mb-12 fade-in">
            <div class="bg-[#0d0d0d] border border-white/5 rounded-[2.5rem] p-8 md:p-10 flex flex-col md:flex-row items-center gap-8 md:gap-12">
                <div class="flex-1 w-full">
                    <div class="flex justify-between items-end mb-4">
                        <div>
                            <h2 class="text-[9px] font-bold text-gray-500 uppercase tracking-[0.2em] mb-1">O Teu Progresso</h2>
                            <div class="flex items-baseline gap-2">
                                <span id="total-completed" class="text-4xl font-bold text-white tracking-tighter">0h 0m</span>
                                <span id="total-goal" class="text-gray-600 font-medium text-xs">de 0h 0m</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <span id="global-percentage" class="text-2xl font-bold text-purple-500 tracking-tighter">0%</span>
                        </div>
                    </div>
                    <div class="w-full bg-white/5 h-3 rounded-full overflow-hidden p-0.5 border border-white/5">
                        <div id="global-progress-bar" class="h-full bg-purple-600 rounded-full transition-all duration-1000 ease-out shadow-[0_0_20px_rgba(147,51,234,0.3)]" style="width: 0%"></div>
                    </div>
                </div>
                <div class="hidden md:flex flex-col items-center justify-center border-l border-white/5 pl-12 h-20">
                    <i data-lucide="activity" class="text-purple-500 w-8 h-8 mb-2 opacity-50"></i>
                    <span class="text-[9px] font-bold text-gray-600 uppercase tracking-[0.1em]">Performance</span>
                </div>
            </div>
        </section>

        <!-- ABA MATÉRIAS -->
        <div id="content-materias" class="fade-in">
            <div class="flex justify-between items-end mb-10 px-4 md:px-0">
                <div>
                    <h2 class="text-3xl font-bold text-white tracking-tight mb-1">Painel de Estudo</h2>
                    <p class="text-gray-500 text-sm font-medium">Controle o seu tempo e atinja as suas metas.</p>
                </div>
                <button onclick="toggleModal('modal-materia', true)" class="bg-purple-600 hover:bg-purple-500 text-white px-6 py-3 rounded-2xl text-[10px] font-bold tracking-[0.1em] flex items-center gap-2 transition-all shadow-xl shadow-purple-600/10 uppercase">
                    <i data-lucide="plus" class="w-4 h-4"></i> Adicionar Matéria
                </button>
            </div>
            <div id="subjects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Conteúdo via JS -->
            </div>
        </div>

        <!-- ABA ORGANIZAÇÃO -->
        <div id="content-organizacao" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-10 fade-in">
            <div class="lg:col-span-7 space-y-8">
                <div class="bg-[#0d0d0d] p-10 rounded-[2.5rem] border border-white/5">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <h3 id="calendar-month" class="text-2xl font-bold text-white tracking-tight capitalize">Mês</h3>
                            <p id="calendar-year" class="text-gray-500 text-[10px] font-bold uppercase tracking-[0.2em]">Ano</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="changeMonth(-1)" class="p-3 bg-white/5 rounded-xl hover:text-purple-500 transition-colors"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                            <button onclick="changeMonth(1)" class="p-3 bg-white/5 rounded-xl hover:text-purple-500 transition-colors"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                    <div class="grid grid-cols-7 gap-4 text-center text-[9px] text-gray-600 font-bold mb-6 tracking-widest uppercase">
                        <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sab</div>
                    </div>
                    <div id="calendar-days" class="grid grid-cols-7 gap-3">
                        <!-- Dias via JS -->
                    </div>
                </div>

                <div class="bg-[#0d0d0d] p-10 rounded-[2.5rem] border border-white/5">
                    <h3 class="text-lg font-bold text-white mb-6">Novo Planejamento</h3>
                    <div class="flex flex-col gap-4">
                        <div class="flex flex-col sm:flex-row gap-4">
                            <input id="task-input" type="text" placeholder="Tarefa a realizar..." class="flex-1 bg-[#151515] border border-white/5 rounded-2xl px-6 py-4 text-sm outline-none focus:border-purple-600/50 transition-colors">
                            <div class="relative flex items-center bg-[#151515] border border-white/5 rounded-2xl px-4 py-4 group focus-within:border-purple-600/50 transition-colors">
                                <i data-lucide="calendar" class="w-4 h-4 text-gray-500 mr-2"></i>
                                <input id="task-date" type="date" class="bg-transparent text-xs font-bold text-gray-300 outline-none uppercase tracking-widest">
                            </div>
                        </div>
                        <button onclick="addTask()" class="w-full bg-purple-600 py-4 rounded-2xl text-[10px] font-bold uppercase tracking-[0.2em] hover:bg-purple-500 transition-all shadow-lg shadow-purple-600/10">
                            Adicionar à Agenda
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5">
                <div class="bg-[#0d0d0d] p-10 rounded-[2.5rem] border border-white/5 h-full">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <h3 class="text-xl font-bold text-white">Agenda</h3>
                            <p id="selected-date-label" class="text-[9px] text-gray-500 uppercase font-bold tracking-[0.2em] mt-1">Data</p>
                        </div>
                        <span id="task-count" class="text-[9px] font-bold text-purple-400 bg-purple-400/10 px-3 py-1.5 rounded-full uppercase tracking-widest">0 Tarefas</span>
                    </div>
                    <div id="tasks-list" class="space-y-4 custom-scrollbar overflow-y-auto max-h-[500px]">
                        <!-- Tarefas via JS -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- MODO FOCO -->
    <div id="timer-screen" class="hidden fixed inset-0 bg-[#050505] z-50 flex flex-col items-center justify-center p-10 fade-in">
        <button onclick="closeTimer()" class="absolute top-10 right-10 text-gray-600 hover:text-white transition-colors"><i data-lucide="x" class="w-10 h-10"></i></button>
        <div class="text-center space-y-4 mb-16">
            <span class="text-[10px] font-bold tracking-[0.5em] text-purple-500 uppercase">Foco Ativo</span>
            <h2 id="timer-subject-title" class="text-4xl font-bold text-white tracking-tight">Matéria</h2>
        </div>
        <div id="timer-display" class="text-[120px] md:text-[180px] font-bold leading-none mb-16 text-white tracking-tighter">00:00:00</div>
        <div class="flex items-center gap-10">
            <button onclick="resetCurrentTimer()" class="p-6 bg-white/5 rounded-[2rem] text-gray-500 hover:text-white transition-all border border-white/5"><i data-lucide="rotate-ccw" class="w-8 h-8"></i></button>
            <button id="play-pause-btn" onclick="toggleTimer()" class="w-32 h-32 rounded-[3.5rem] flex items-center justify-center transition-all transform active:scale-95 bg-purple-600 text-white shadow-2xl shadow-purple-600/40">
                <i id="play-pause-icon" data-lucide="play" class="w-12 h-12 fill-current"></i>
            </button>
            <div class="w-20"></div>
        </div>
    </div>

    <!-- MODAL -->
    <div id="modal-materia" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center p-6 z-[60] backdrop-blur-xl fade-in">
        <div class="bg-[#0d0d0d] p-12 rounded-[3rem] w-full max-w-md border border-white/5 shadow-2xl">
            <h3 class="text-2xl font-bold mb-8 text-white">Nova Matéria</h3>
            <div class="space-y-6">
                <div>
                    <label class="text-[9px] font-bold text-gray-600 uppercase tracking-widest">Nome da Disciplina</label>
                    <input id="new-subject-name" type="text" placeholder="Ex: Anatomia" class="w-full bg-[#151515] border border-white/5 p-5 rounded-2xl outline-none focus:border-purple-600/50 mt-2 text-sm">
                </div>
                <div>
                    <label class="text-[9px] font-bold text-gray-600 uppercase tracking-widest">Meta Diária (Horas)</label>
                    <input id="new-subject-hours" type="number" placeholder="4" class="w-full bg-[#151515] border border-white/5 p-5 rounded-2xl outline-none focus:border-purple-600/50 mt-2 text-sm">
                </div>
                <button onclick="createSubject()" class="w-full bg-purple-600 py-5 rounded-[1.8rem] text-[10px] font-bold uppercase tracking-[0.2em] hover:bg-purple-500 transition-all">Guardar</button>
                <button onclick="toggleModal('modal-materia', false)" class="w-full text-gray-600 text-[9px] font-bold uppercase tracking-widest hover:text-white transition-colors">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        let subjects = [
            { id: 1, title: 'Geometria Descritiva', totalSeconds: 14400, remainingSeconds: 14400 },
            { id: 2, title: 'História A', totalSeconds: 10800, remainingSeconds: 5400 },
            { id: 3, title: 'Psicologia', totalSeconds: 7200, remainingSeconds: 7200 }
        ];
        let tasks = [
            { id: 1, text: 'Revisão capítulo 4', completed: false, date: new Date().toISOString().split('T')[0] }
        ];
        
        let currentTab = 'materias';
        let currentDate = new Date();
        let selectedDateStr = new Date().toISOString().split('T')[0];
        let timerInterval = null;
        let activeSubjectId = null;

        window.onload = () => {
            document.getElementById('task-date').value = selectedDateStr;
            render();
            lucide.createIcons();
        };

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('content-materias').classList.toggle('hidden', tab !== 'materias');
            document.getElementById('content-organizacao').classList.toggle('hidden', tab !== 'organizacao');
            
            const btnMat = document.getElementById('tab-materias');
            const btnOrg = document.getElementById('tab-organizacao');
            
            if(tab === 'materias') {
                btnMat.className = "px-8 py-2.5 rounded-xl text-[10px] font-bold tracking-widest transition-all bg-[#1a1a1a] text-purple-400 border border-white/5 uppercase";
                btnOrg.className = "px-8 py-2.5 rounded-xl text-[10px] font-bold tracking-widest transition-all text-gray-500 hover:text-gray-300 uppercase";
            } else {
                btnMat.className = "px-8 py-2.5 rounded-xl text-[10px] font-bold tracking-widest transition-all text-gray-500 hover:text-gray-300 uppercase";
                btnOrg.className = "px-8 py-2.5 rounded-xl text-[10px] font-bold tracking-widest transition-all bg-[#1a1a1a] text-purple-400 border border-white/5 uppercase";
            }
            render();
        }

        function toggleModal(id, show) {
            document.getElementById(id).classList.toggle('hidden', !show);
        }

        function formatTime(s) {
            const h = Math.floor(s / 3600).toString().padStart(2, '0');
            const m = Math.floor((s % 3600) / 60).toString().padStart(2, '0');
            const sec = (s % 60).toString().padStart(2, '0');
            return `${h}:${m}:${sec}`;
        }

        function formatShortTime(s) {
            return `${Math.floor(s / 3600)}h ${Math.floor((s % 3600) / 60)}m`;
        }

        function render() {
            renderDashboard();
            if (currentTab === 'materias') renderSubjects();
            else renderOrganization();
            lucide.createIcons();
        }

        function renderDashboard() {
            const totalGoal = subjects.reduce((a, b) => a + b.totalSeconds, 0);
            const totalRemaining = subjects.reduce((a, b) => a + b.remainingSeconds, 0);
            const completed = totalGoal - totalRemaining;
            const pct = totalGoal > 0 ? (completed / totalGoal) * 100 : 0;

            document.getElementById('total-completed').innerText = formatShortTime(completed);
            document.getElementById('total-goal').innerText = `de ${formatShortTime(totalGoal)}`;
            document.getElementById('global-percentage').innerText = `${pct.toFixed(0)}%`;
            document.getElementById('global-progress-bar').style.width = `${pct}%`;
        }

        function renderSubjects() {
            const grid = document.getElementById('subjects-grid');
            grid.innerHTML = subjects.map(sub => `
                <div class="bg-[#0d0d0d] border border-white/5 rounded-[2.5rem] p-8 relative group hover:border-purple-500/30 transition-all duration-300 fade-in">
                    <div class="mb-8">
                        <h3 class="text-xl font-bold text-white mb-2">${sub.title}</h3>
                        <div class="flex items-center gap-2">
                            <span class="w-1.5 h-1.5 rounded-full bg-purple-500"></span>
                            <span class="text-[9px] font-bold text-gray-500 uppercase tracking-[0.1em]">Ativo</span>
                        </div>
                    </div>
                    <div class="space-y-4 mb-10">
                        <div class="flex justify-between text-[10px] font-bold tracking-widest uppercase">
                            <span class="text-gray-500">Total: ${formatShortTime(sub.totalSeconds)}</span>
                            <span class="text-purple-400">Falta: ${formatTime(sub.remainingSeconds)}</span>
                        </div>
                        <div class="w-full bg-white/5 h-2 rounded-full overflow-hidden">
                            <div class="h-full bg-purple-600 rounded-full transition-all duration-1000" style="width: ${((sub.totalSeconds - sub.remainingSeconds)/sub.totalSeconds)*100}%"></div>
                        </div>
                    </div>
                    <button onclick="startSession(${sub.id})" class="w-full bg-white/5 hover:bg-purple-600 text-gray-300 hover:text-white py-4 rounded-2xl text-[9px] font-bold uppercase tracking-[0.2em] border border-white/5 transition-all">
                        Iniciar Sessão
                    </button>
                    <button onclick="deleteSubject(${sub.id})" class="absolute top-6 right-6 opacity-0 group-hover:opacity-100 text-gray-600 hover:text-red-500 transition-all">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            `).join('');
        }

        function renderOrganization() {
            renderCalendar();
            renderTasks();
        }

        function renderCalendar() {
            const monthLabel = document.getElementById('calendar-month');
            const yearLabel = document.getElementById('calendar-year');
            const grid = document.getElementById('calendar-days');
            
            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();
            
            monthLabel.innerText = new Intl.DateTimeFormat('pt-BR', { month: 'long' }).format(currentDate);
            yearLabel.innerText = year;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const todayStr = new Date().toISOString().split('T')[0];

            grid.innerHTML = '';
            for (let i = 0; i < firstDay; i++) grid.innerHTML += '<div></div>';
            
            for (let d = 1; d <= daysInMonth; d++) {
                const dateObj = new Date(year, month, d);
                const dStr = dateObj.toISOString().split('T')[0];
                const isSelected = dStr === selectedDateStr;
                const isToday = dStr === todayStr;

                grid.innerHTML += `
                    <div onclick="selectDate('${dStr}')" class="aspect-square flex items-center justify-center text-sm rounded-2xl transition-all cursor-pointer font-bold 
                        ${isSelected ? 'bg-purple-600 text-white shadow-lg shadow-purple-600/20 scale-110' : 
                          isToday ? 'border border-purple-500/30 text-purple-400' : 'hover:bg-white/5 text-gray-500 hover:text-gray-200'}">
                        ${d}
                    </div>
                `;
            }
        }

        function renderTasks() {
            const list = document.getElementById('tasks-list');
            const label = document.getElementById('selected-date-label');
            const count = document.getElementById('task-count');
            
            // Corrige o problema da data exibindo o dia anterior
            const [year, month, day] = selectedDateStr.split('-').map(Number);
            const correctDate = new Date(year, month - 1, day);
            
            const daily = tasks.filter(t => t.date === selectedDateStr);
            label.innerText = correctDate.toLocaleDateString('pt-BR', { day: '2-digit', month: 'long' });
            count.innerText = `${daily.length} Tarefas`;

            if (daily.length === 0) {
                list.innerHTML = '<div class="text-center py-20 text-gray-700 text-xs font-medium italic">Agenda livre.</div>';
                return;
            }

            list.innerHTML = daily.map(t => `
                <div class="flex items-center gap-4 p-5 bg-[#151515] rounded-[1.8rem] border border-white/5 group fade-in">
                    <div onclick="toggleTask(${t.id})" class="w-6 h-6 rounded-lg flex items-center justify-center border-2 cursor-pointer transition-colors ${t.completed ? 'bg-purple-600 border-purple-600' : 'border-gray-800'}">
                        ${t.completed ? '<i data-lucide="check" class="w-4 h-4 text-white"></i>' : ''}
                    </div>
                    <span class="flex-1 text-sm font-medium ${t.completed ? 'text-gray-600 line-through' : 'text-gray-200'}">${t.text}</span>
                    <button onclick="deleteTask(${t.id})" class="opacity-0 group-hover:opacity-100 p-2 text-gray-700 hover:text-red-500 transition-all"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function selectDate(dStr) {
            selectedDateStr = dStr;
            render();
        }

        function changeMonth(dir) {
            currentDate.setMonth(currentDate.getMonth() + dir);
            render();
        }

        function createSubject() {
            const name = document.getElementById('new-subject-name').value;
            const hours = parseInt(document.getElementById('new-subject-hours').value);
            if (!name || !hours) return;
            
            subjects.push({ id: Date.now(), title: name, totalSeconds: hours * 3600, remainingSeconds: hours * 3600 });
            toggleModal('modal-materia', false);
            document.getElementById('new-subject-name').value = '';
            document.getElementById('new-subject-hours').value = '';
            render();
        }

        function deleteSubject(id) {
            subjects = subjects.filter(s => s.id !== id);
            render();
        }

        function addTask() {
            const text = document.getElementById('task-input').value;
            const date = document.getElementById('task-date').value;
            if (!text || !date) return;

            tasks.push({ id: Date.now(), text, date, completed: false });
            document.getElementById('task-input').value = '';
            render();
        }

        function toggleTask(id) {
            tasks = tasks.map(t => t.id === id ? {...t, completed: !t.completed} : t);
            render();
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            render();
        }

        function startSession(id) {
            activeSubjectId = id;
            const sub = subjects.find(s => s.id === id);
            document.getElementById('timer-subject-title').innerText = sub.title;
            document.getElementById('timer-display').innerText = formatTime(sub.remainingSeconds);
            document.getElementById('timer-screen').classList.remove('hidden');
        }

        function toggleTimer() {
            const btn = document.getElementById('play-pause-btn');
            const icon = document.getElementById('play-pause-icon');
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                btn.className = "w-32 h-32 rounded-[3.5rem] flex items-center justify-center transition-all transform active:scale-95 bg-purple-600 text-white shadow-2xl shadow-purple-600/40";
                icon.setAttribute('data-lucide', 'play');
            } else {
                timerInterval = setInterval(() => {
                    const sub = subjects.find(s => s.id === activeSubjectId);
                    if (sub.remainingSeconds > 0) {
                        sub.remainingSeconds--;
                        document.getElementById('timer-display').innerText = formatTime(sub.remainingSeconds);
                        renderDashboard();
                    } else {
                        toggleTimer();
                    }
                }, 1000);
                btn.className = "w-32 h-32 rounded-[3.5rem] flex items-center justify-center transition-all transform active:scale-95 bg-amber-600/10 text-amber-500 border-2 border-amber-500/30";
                icon.setAttribute('data-lucide', 'pause');
            }
            lucide.createIcons();
        }

        function resetCurrentTimer() {
            const sub = subjects.find(s => s.id === activeSubjectId);
            sub.remainingSeconds = sub.totalSeconds;
            document.getElementById('timer-display').innerText = formatTime(sub.remainingSeconds);
            render();
        }

        function closeTimer() {
            if (timerInterval) toggleTimer();
            document.getElementById('timer-screen').classList.add('hidden');
            render();
        }
    </script>
</body>
</html>
